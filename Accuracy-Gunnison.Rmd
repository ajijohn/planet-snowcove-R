---
title: "Accuracy-Gunnison"
author: "Aji John"
date: "10/30/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
library(terra)
```

## Stack the layers

You can also embed plots, for example:

```{r , echo=FALSE}
aso_co <- rast('data/dem_stackedco_demandfriendsnormalized_asov3.tiff')
pred_co <- rast('data/dem_stackedco_demandfriendsnormalized_predv3.tiff')
```


## Lets stack them
```{r , echo=FALSE}
e <- ext(aso_co)
# crop landsat by the extent
planetcrop <- crop(pred_co, e)
writeRaster(planetcrop, filename="data/cropped-dem_stackedco_demandfriendsnormalized_predv3.tiff", overwrite=TRUE)
x <- c(aso_co,planetcrop)
```

# Skip to start from here
#read the clipped pred
```{r , echo=FALSE}
library(terra)
aso_co <- rast('data/dem_stackedco_demandfriendsnormalized_asov3.tiff')
predclip_co <- rast('data/cropped-dem_stackedco_demandfriendsnormalized_predv3.tiff')

x <- c(aso_co,predclip_co)
```

# get values
```{r , echo=FALSE}

aso_df <- terra::values(aso_co,mat=FALSE)
pred_df <- terra::values(predclip_co,mat=FALSE)

aso_df <- as.data.frame(aso_df)
pred_df <- as.data.frame(pred_df)

df <- data.frame(aso_df,pred_df)
colnames(df) <= c('aso','pred')
```
# Far more efficient, sum the layers
```{r , echo=FALSE}
library(caret)
df_filtered <- df[complete.cases(df),]
#confusionMatrix(df$aso,df$pred,mode = 'prec_recall')
```

```{r , echo=FALSE}
confusionMatrix(as.factor(df_filtered$aso),as.factor(df_filtered$pred),mode = 'prec_recall')
```

# Far more efficient, sum the layers
```{r , echo=FALSE}
s <- app(x, fun=sum,nodes=8)
```

# plot the added raster - 0 - good, 1- disagee , 2- agree
```{r , echo=FALSE}
plot(s)
```
```{r , echo=FALSE}
nosnowmatch <- freq(s, value=0)
nosnowmismatch <- freq(s, value=1)
snowsnowmatch <- freq(s, value=2)

total_matchmismatch <- nosnowmatch[3] + nosnowmismatch[3] + snowsnowmatch[3]
```


leaflet
```{r , echo=FALSE}
library(leaflet)
agreeordis <- raster(s)
m <- leaflet() %>% setView(lng = -107, lat = 38.9, zoom = 15)
m %>% 
  addProviderTiles("Esri.WorldImagery") 
```


# utterly inefocent code
```{r , echo=FALSE}
#data_matrix_co <- as.points(x)
#head(data_matrix_co)
```


